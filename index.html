<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Easy Apply Jobs</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- PapaParse -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
  body { font-family: Helvetica, Arial, sans-serif; }
</style>
</head>

<body class="bg-gray-50 min-h-screen">
<div class="bg-white sticky top-0 z-40 border-b">
  <div class="max-w-6xl mx-auto p-4">
    <div class="flex flex-col gap-3">
      <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold text-[#075A57]">Easy Apply Jobs</h1>
      </div>

      <div class="flex gap-2">
        <button id="allBtn"
          class="px-4 py-2 rounded-lg bg-[#00917C] text-white">
          All Jobs
        </button>
        <button id="savedBtn"
          class="px-4 py-2 rounded-lg bg-gray-100 text-gray-700">
          Saved (0)
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <input id="searchInput"
          class="border rounded-lg px-4 py-3"
          placeholder="Job title or company">
        <input id="locationInput"
          class="border rounded-lg px-4 py-3"
          placeholder="Location">
        <button id="searchBtn"
          class="bg-[#00917C] text-white rounded-lg px-6 py-3 hover:bg-[#075A57]">
          Search Jobs
        </button>
      </div>

      <p id="resultCount" class="text-sm text-gray-600 hidden"></p>
    </div>
  </div>
</div>

<div class="max-w-6xl mx-auto p-4">
  <div id="emptyState" class="text-center text-gray-500 py-24">
    <h2 class="text-xl font-semibold mb-2">Find your next opportunity</h2>
    <p>Search by job title, company, or location to get started.</p>
  </div>

  <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 hidden"></div>

  <div class="flex justify-center mt-6">
    <button id="loadMoreBtn"
      class="hidden bg-[#00917C] text-white px-6 py-3 rounded-lg hover:bg-[#075A57]">
      Load more jobs
    </button>
  </div>
</div>

<script>
/* =====================
   MOBILE-SAFE ARCHITECTURE
===================== */

const PAGE_SIZE = 30;

const state = {
  jobs: [],
  filtered: [],
  renderedCount: 0,
  view: "all", // all | saved
  savedIds: new Set(),
  hasSearched: false
};

const resultsEl = document.getElementById("results");
const emptyStateEl = document.getElementById("emptyState");
const resultCountEl = document.getElementById("resultCount");
const loadMoreBtn = document.getElementById("loadMoreBtn");
const savedBtn = document.getElementById("savedBtn");

const searchInput = document.getElementById("searchInput");
const locationInput = document.getElementById("locationInput");

function getJobId(job) {
  return `${job.Company}-${job["Job Title"]}-${job.Location}`
    .replace(/\s+/g, "-")
    .toLowerCase();
}

/* =====================
   STORAGE (SAFE)
===================== */
function loadSaved() {
  try {
    const raw = localStorage.getItem("saved-jobs");
    if (raw) state.savedIds = new Set(JSON.parse(raw));
  } catch {}
}

function persistSaved() {
  try {
    localStorage.setItem("saved-jobs", JSON.stringify([...state.savedIds]));
  } catch {}
}

function updateSavedCount() {
  savedBtn.textContent = `Saved (${state.savedIds.size})`;
}

/* =====================
   RENDERING (INCREMENTAL)
===================== */
function clearResults() {
  resultsEl.innerHTML = "";
  state.renderedCount = 0;
}

function renderNextBatch() {
  const next = state.filtered.slice(
    state.renderedCount,
    state.renderedCount + PAGE_SIZE
  );

  next.forEach(job => {
    const id = getJobId(job);

    const card = document.createElement("div");
    card.className =
      "bg-white border rounded-xl p-5 shadow-sm hover:shadow-md transition";

    const title = document.createElement("h3");
    title.className = "font-semibold text-lg mb-2";
    title.textContent = job["Job Title"] || "";

    const company = document.createElement("p");
    company.className = "text-[#00917C] font-medium mb-1";
    company.textContent = job.Company || "";

    const location = document.createElement("p");
    location.className = "text-sm text-gray-500 mb-3";
    location.textContent = job.Location || "";

    const actions = document.createElement("div");
    actions.className = "flex items-center gap-3";

    if (job["URL FOR Job Title"]) {
      const apply = document.createElement("a");
      apply.href = job["URL FOR Job Title"];
      apply.target = "_blank";
      apply.className =
        "text-sm bg-[#00917C] text-white px-4 py-2 rounded-lg";
      apply.textContent = "Apply";
      actions.appendChild(apply);
    }

    const saveBtn = document.createElement("button");
    saveBtn.className = "text-sm text-[#00917C]";
    saveBtn.textContent = state.savedIds.has(id) ? "Saved" : "Save";

    saveBtn.onclick = () => {
      if (state.savedIds.has(id)) {
        state.savedIds.delete(id);
        saveBtn.textContent = "Save";
      } else {
        state.savedIds.add(id);
        saveBtn.textContent = "Saved";
      }
      persistSaved();
      updateSavedCount();

      if (state.view === "saved" && !state.savedIds.has(id)) {
        card.remove();
      }
    };

    actions.appendChild(saveBtn);

    card.appendChild(title);
    card.appendChild(company);
    card.appendChild(location);
    card.appendChild(actions);

    resultsEl.appendChild(card);
  });

  state.renderedCount += next.length;

  resultCountEl.textContent =
    `Showing ${state.renderedCount.toLocaleString()} of ${state.filtered.length.toLocaleString()} jobs`;

  resultCountEl.classList.remove("hidden");

  loadMoreBtn.classList.toggle(
    "hidden",
    state.renderedCount >= state.filtered.length
  );
}

/* =====================
   FILTERING
===================== */
function filterJobs() {
  const t = searchInput.value.toLowerCase();
  const l = locationInput.value.toLowerCase();

  let source =
    state.view === "saved"
      ? state.jobs.filter(j => state.savedIds.has(getJobId(j)))
      : state.jobs;

  state.filtered = source.filter(j => {
    const titleMatch =
      !t ||
      j["Job Title"]?.toLowerCase().includes(t) ||
      j.Company?.toLowerCase().includes(t);

    const locMatch =
      !l || j.Location?.toLowerCase().includes(l);

    return titleMatch && locMatch;
  });

  state.hasSearched = true;
  emptyStateEl.classList.add("hidden");
  resultsEl.classList.remove("hidden");

  clearResults();
  renderNextBatch();
}

/* =====================
   EVENTS
===================== */
searchInput.addEventListener("keydown", e => {
  if (e.key === "Enter") filterJobs();
});
locationInput.addEventListener("keydown", e => {
  if (e.key === "Enter") filterJobs();
});
document.getElementById("searchBtn").onclick = filterJobs;

document.getElementById("allBtn").onclick = () => {
  state.view = "all";
  document.getElementById("allBtn").className =
    "px-4 py-2 rounded-lg bg-[#00917C] text-white";
  savedBtn.className =
    "px-4 py-2 rounded-lg bg-gray-100 text-gray-700";
  if (state.hasSearched) filterJobs();
};

savedBtn.onclick = () => {
  state.view = "saved";
  savedBtn.className =
    "px-4 py-2 rounded-lg bg-[#00917C] text-white";
  document.getElementById("allBtn").className =
    "px-4 py-2 rounded-lg bg-gray-100 text-gray-700";
  if (state.hasSearched) filterJobs();
};

loadMoreBtn.onclick = renderNextBatch;

/* =====================
   INIT
===================== */
loadSaved();
updateSavedCount();

fetch("https://raw.githubusercontent.com/easyapplyjobs/easyapplyjobs-data/refs/heads/main/jobs.csv")
  .then(r => r.text())
  .then(csv => {
    Papa.parse(csv, {
      header: true,
      skipEmptyLines: true,
      complete: res => {
        state.jobs = res.data.filter(j => j["Job Title"]);
      }
    });
  });
</script>
</body>
</html>
